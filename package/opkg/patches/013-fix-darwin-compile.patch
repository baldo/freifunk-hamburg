--- a/libopkg/opkg_download.c
+++ b/libopkg/opkg_download.c
@@ -21,6 +21,7 @@
 
 #include <stdio.h>
 #include <unistd.h>
+#include <libgen.h>
 
 #include "opkg_download.h"
 #include "opkg_message.h"
--- a/libopkg/pkg.c
+++ b/libopkg/pkg.c
@@ -21,6 +21,7 @@
 #include <string.h>
 #include <ctype.h>
 #include <unistd.h>
+#include <libgen.h>
 
 #include "pkg.h"
 
--- a/tests/libopkg_test.c
+++ b/tests/libopkg_test.c
@@ -5,6 +5,7 @@
 
 #include <opkg.h>
 
+int opkg_state_changed;
 pkg_t *find_pkg = NULL;
 
 
